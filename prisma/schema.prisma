// This file is auto-generated. Do not edit manually.
// Edit files in prisma/schemas/ directory instead.
// Last generated: 2025-12-25T14:43:02.730Z
// InvenStock - Multi-Tenant Inventory Management System V1.0

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema", "relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // For connection pooling
}


// ==========================================
// BASE SCHEMA - V1.0
// ==========================================

// prisma/schemas/base.prisma
// ===== MINIMAL CORE ENUMS - Invite Code Only System =====

// ===== USER & ORGANIZATION ENUMS =====
enum UserStatus {
  PENDING    // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô email
  ACTIVE     // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  SUSPENDED  // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  INACTIVE   // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
}

enum OrganizationStatus {
  ACTIVE     // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  SUSPENDED  // ‡∏£‡∏∞‡∏á‡∏±‡∏ö
  TRIAL      // ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ
}

// ===== SIMPLIFIED ROLE SYSTEM =====
enum OrganizationRole {
  MEMBER  // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏ö‡∏¥‡∏Å ‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏Å‡πâ‡∏™‡∏ï‡πá‡∏≠‡∏Å ‡∏î‡∏π‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
  ADMIN   // Member + CRUD ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô + ‡πÄ‡∏ä‡∏¥‡∏ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 
  OWNER   // Admin + ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ + ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
}

// ===== UI ENUMS FOR COLORS & ICONS =====
enum ColorTheme {
  BLUE         // #3B82F6 - ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
  GREEN        // #10B981 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
  RED          // #EF4444 - ‡∏™‡∏µ‡πÅ‡∏î‡∏á
  YELLOW       // #F59E0B - ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
  PURPLE       // #8B5CF6 - ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á
  PINK         // #EC4899 - ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π
  INDIGO       // #6366F1 - ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°
  TEAL         // #14B8A6 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ü‡πâ‡∏≤
  ORANGE       // #F97316 - ‡∏™‡∏µ‡∏™‡πâ‡∏°
  GRAY         // #6B7280 - ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
  SLATE        // #475569 - ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°
  EMERALD      // #059669 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏£‡∏Å‡∏ï
}

enum IconType {
  // Department Icons
  BUILDING     // üè¢ ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  HOSPITAL     // üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
  PHARMACY     // üíä ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤
  WAREHOUSE    // üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  LABORATORY   // üß™ ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πá‡∏ö
  
  // Product Category Icons
  PILL         // üíä ‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î
  BOTTLE       // üçº ‡∏¢‡∏≤‡∏ô‡πâ‡∏≥
  SYRINGE      // üíâ ‡∏¢‡∏≤‡∏â‡∏µ‡∏î
  BANDAGE      // ü©π ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
  STETHOSCOPE  // ü©∫ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå
  
  // Role Icons
  CROWN        // üëë ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
  SHIELD       // üõ°‡πå ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
  PERSON       // üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  EYE          // üëÅÔ∏è ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  GEAR         // ‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö
  
  // General Icons
  BOX          // üì¶ ‡∏Å‡∏•‡πà‡∏≠‡∏á
  FOLDER       // üìÅ ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
  TAG          // üè∑Ô∏è ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö
  STAR         // ‚≠ê ‡∏î‡∏≤‡∏ß
  HEART        // ‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à
  CIRCLE       // ‚ö™ ‡∏ß‡∏á‡∏Å‡∏•‡∏°
  SQUARE       // ‚¨ú ‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°
  TRIANGLE     // üî∫ ‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°
}

// ===== ‚úÖ NEW: USER SNAPSHOT TYPE =====
// ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Audit Logs ‡πÅ‡∏•‡∏∞ Records ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
// Structure:
// {
//   "userId": "clxxx",
//   "username": "admin01",
//   "fullName": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
//   "email": "somchai@hospital.com",
//   "role": "ADMIN" // Role ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ context)
// }

// ==========================================
// USER SCHEMA - V1.0
// ==========================================

// prisma/schemas/user.prisma
// ===== USER MANAGEMENT SCHEMA - Clean & Simple =====

model User {
  id          String     @id @default(cuid())
  email       String?    // Optional for notifications/recovery
  username    String     @unique  // Primary login credential
  password    String     // bcrypt hashed
  
  // Personal Information
  firstName   String
  lastName    String
  phone       String?
  
  // Account Status
  status      UserStatus @default(PENDING)
  isActive    Boolean    @default(true)
  emailVerified Boolean  @default(false)
  
  // Security
  lastLogin   DateTime?
  
  // Timestamps
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  organizationUsers   OrganizationUser[]
  auditLogsAsUser     AuditLog[] @relation("AuditLogUser")
  auditLogsAsTarget   AuditLog[] @relation("AuditLogTarget")
  
  @@index([email])
  @@index([username])
  @@index([status])
  @@index([isActive])
  @@map("users")
}

// ==========================================
// ORGANIZATION SCHEMA - V1.0
// ==========================================

// prisma/schemas/organization.prisma
// ===== ORGANIZATION SCHEMA WITH USER SNAPSHOTS =====

model Organization {
  id          String             @id @default(cuid())
  name        String
  slug        String             @unique
  description String?
  
  // Contact Information
  email       String?
  phone       String?
  
  // Visual Customization
  color       ColorTheme?        @default(BLUE)
  icon        IconType?          @default(BUILDING)
  
  // Settings
  status      OrganizationStatus @default(ACTIVE)
  timezone    String             @default("Asia/Bangkok")
  
  // Invite Code System
  inviteCode     String?    @unique
  inviteEnabled  Boolean    @default(true)
  
  // Timestamps
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  
  // Relations
  users       OrganizationUser[]
  departments Department[]
  auditLogs   AuditLog[]
  
  // Product-related relations
  products              Product[]
  productAttributeCategories ProductAttributeCategory[]
  productUnits          ProductUnit[]
  stocks                Stock[]
  
  // Transfer relations
  transfers             Transfer[]
  
  @@index([slug])
  @@index([status])
  @@index([inviteCode])
  @@map("organizations")
}

// User-Organization Relationship
model OrganizationUser {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  
  // Role & Membership
  roles          OrganizationRole @default(MEMBER)
  isOwner        Boolean      @default(false)
  joinedAt       DateTime     @default(now())
  lastActiveAt   DateTime?
  
  // Status
  isActive       Boolean      @default(true)
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, userId])
  @@index([isActive])
  @@index([roles])
  @@map("organization_users")
}

// Department with User Snapshots + Transfer relations
model Department {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?
  
  // Department Details
  name           String
  slug           String
  description    String?
  color          ColorTheme?
  icon           IconType?
  
  // Status
  isActive       Boolean      @default(true)
  
  // User Tracking
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children       Department[] @relation("DepartmentHierarchy")
  auditLogs      AuditLog[]
  stocks         Stock[]
  
  // Transfer relations
  outgoingTransfers Transfer[] @relation("TransferSupplying")
  incomingTransfers Transfer[] @relation("TransferRequesting")
  
  @@unique([organizationId, slug])
  @@index([parentId])
  @@index([isActive])
  @@map("departments")
}

// ==========================================
// PRODUCT SCHEMA - V1.0
// ==========================================

// prisma/schemas/product.prisma

// ===== PRODUCT UNIT (SIMPLIFIED) =====
model ProductUnit {
  id               String   @id @default(cuid())
  organizationId   String
  
  // Basic Info
  name             String   // "‡πÇ‡∏´‡∏•", "‡∏•‡∏±‡∏á", "‡∏Å‡∏•‡πà‡∏≠‡∏á"
  conversionRatio  Decimal  @db.Decimal(10, 4)  // 1 ‡πÇ‡∏´‡∏• = 12 ‡∏´‡∏ô‡πà‡∏ß‡∏¢
  
  // Status
  isActive         Boolean  @default(true)
  
  // User Tracking
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  // Timestamps
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Relations
  organization     Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, name])
  @@index([organizationId, isActive])
  @@map("product_units")
}

// ===== PRODUCT ATTRIBUTE CATEGORY (Definition) =====
model ProductAttributeCategory {
  id             String   @id @default(cuid())
  organizationId String
  
  // Category Info
  key            String   // "dosage_form", "drug_type", "manufacturer"
  label          String   // "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤", "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï"
  description    String?
  
  // Display & Validation
  displayOrder   Int      @default(0)
  isRequired     Boolean  @default(false)
  isActive       Boolean  @default(true)
  
  // User Tracking
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // ‚úÖ Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  options        ProductAttributeOption[]
  productAttributes ProductAttribute[]
  
  @@unique([organizationId, key])
  @@index([organizationId, isActive])
  @@map("product_attribute_categories")
}

// ===== PRODUCT ATTRIBUTE OPTION (Values for each category) =====
model ProductAttributeOption {
  id         String   @id @default(cuid())
  categoryId String
  
  value      String   // "‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î", "‡∏¢‡∏≤‡∏ô‡πâ‡∏≥", "‡πÑ‡∏ó‡∏¢", "‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô"
  label      String?  // Optional display label
  sortOrder  Int      @default(0)
  isActive   Boolean  @default(true)
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  // ‚úÖ Relations
  category   ProductAttributeCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  productAttributes ProductAttribute[]
  
  @@unique([categoryId, value])
  @@index([categoryId, isActive])
  @@map("product_attribute_options")
}

// ===== PRODUCT ATTRIBUTE (Junction table connecting Product + Category + Option) =====
model ProductAttribute {
  id         String   @id @default(cuid())
  productId  String
  categoryId String
  optionId   String
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  // ‚úÖ Relations
  product    Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  category   ProductAttributeCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  option     ProductAttributeOption @relation(fields: [optionId], references: [id], onDelete: Restrict)
  
  @@unique([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
  @@index([optionId])
  @@map("product_attributes")
}

// ===== UPDATED PRODUCT MODEL =====
model Product {
  id             String   @id @default(cuid())
  organizationId String
  
  // Basic Info
  code           String
  name           String
  genericName    String?
  description    String?
  
  baseUnit       String
  isActive       Boolean  @default(true)
  
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // ‚úÖ Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  attributes     ProductAttribute[]
  stocks         Stock[]
  transferItems  TransferItem[]
  
  @@unique([organizationId, code])
  @@index([organizationId, isActive])
  @@map("products")
}

// ==========================================
// STOCK SCHEMA - V1.0
// ==========================================

// prisma/schemas/stock.prisma
// ===== STOCK SCHEMA - DEPARTMENT-LEVEL INVENTORY =====

// ===== STOCK (SUMMARY LEVEL - NO QUANTITIES) =====
model Stock {
  id             String   @id @default(cuid())
  organizationId String
  departmentId   String
  productId      String
  
  // Stock Location (within department)
  location       String?  // ‡∏ä‡∏±‡πâ‡∏ô A-1, ‡∏ï‡∏π‡πâ‡∏¢‡∏≤ B, ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ô
  
  // ‚úÖ Department-specific Thresholds
  minStockLevel  Int?     // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤
  maxStockLevel  Int?     // ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö
  reorderPoint   Int?     // ‡∏à‡∏∏‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
  
  // ‚úÖ Default Withdrawal Quantity
  defaultWithdrawalQty Int?  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
  
  // Status
  lastStockCheck DateTime?
  lastMovement   DateTime?
  
  // ‚úÖ USER TRACKING
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  department     Department   @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  product        Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockBatches   StockBatch[]
  
  @@unique([departmentId, productId])
  @@index([organizationId, departmentId])
  @@map("stocks")
}

// ===== STOCK BATCH (ACTUAL INVENTORY WITH QUANTITIES) =====
model StockBatch {
  id             String   @id @default(cuid())
  stockId        String
  
  // ‚úÖ Batch Info
  lotNumber      String
  expiryDate     DateTime?
  manufactureDate DateTime?
  supplier       String?
  
  // ‚úÖ Pricing
  costPrice      Decimal? @db.Decimal(10, 2)
  sellingPrice   Decimal? @db.Decimal(10, 2)
  
  // ‚úÖ Quantity Tracking
  totalQuantity      Int @default(0)  // ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  availableQuantity  Int @default(0)  // ‡∏ß‡πà‡∏≤‡∏á = total - reserved - incoming
  reservedQuantity   Int @default(0)  // ‡∏à‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö approved transfers
  incomingQuantity   Int @default(0)  // ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (pending incoming)
  
  // Location
  location       String?  // ‡∏ä‡∏±‡πâ‡∏ô A-1-05, ‡∏ï‡∏π‡πâ‡∏¢‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 3
  
  // ‚úÖ Status
  status         BatchStatus @default(AVAILABLE)
  isActive       Boolean     @default(true)
  
  // User Tracking
  createdBy         String
  createdBySnapshot Json?
  updatedBy         String?
  updatedBySnapshot Json?
  
  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  receivedAt     DateTime @default(now())
  
  // Relations
  stock          Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)
  transferBatches TransferBatch[]  // ‚úÖ ADDED: Opposite relation for Transfer system
  
  @@unique([stockId, lotNumber])
  @@index([expiryDate])
  @@index([status, isActive])
  @@index([availableQuantity]) // For stock availability checks
  @@map("stock_batches")
}

// ‚úÖ Batch Status Enum
enum BatchStatus {
  AVAILABLE    // ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ
  RESERVED     // ‡∏à‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö transfer
  QUARANTINE   // ‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡∏ô
  DAMAGED      // ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
  EXPIRED      // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
}

// ==========================================
// AUDIT SCHEMA - V1.0
// ==========================================

// prisma/schemas/audit.prisma
// ===== PRODUCTION-READY AUDIT SYSTEM WITH USER SNAPSHOTS =====

model AuditLog {
  id             String        @id @default(cuid())
  organizationId String?
  
  // Actor (‡∏ú‡∏π‡πâ‡∏ó‡∏≥)
  userId         String?
  userSnapshot   Json?
  
  // Target (‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥)
  targetUserId   String?
  targetSnapshot Json?
  
  // Department Context
  departmentId   String?
  
  // Action Classification
  action         String
  category       AuditCategory
  severity       AuditSeverity @default(INFO)
  
  // Human-Readable Description
  description    String
  
  // Resource Tracking
  resourceId     String?
  resourceType   String?
  
  // Detailed Data
  payload        Json?
  
  // Request Context
  ipAddress      String?
  userAgent      String?
  
  // Timestamp
  createdAt      DateTime @default(now())
  
  // Relations
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User? @relation("AuditLogUser", fields: [userId], references: [id], onDelete: SetNull)
  targetUser     User? @relation("AuditLogTarget", fields: [targetUserId], references: [id], onDelete: SetNull)
  department     Department? @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  
  // Optimized Indexes
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([departmentId, createdAt(sort: Desc)])
  @@index([userId, createdAt(sort: Desc)])
  @@index([action])
  @@index([category, severity])
  @@index([resourceId])
  @@map("audit_logs")
}

enum AuditCategory {
  PRODUCT
  STOCK
  TRANSFER
  USER
  ORGANIZATION
  DEPARTMENT
  AUTH
  SYSTEM
}

enum AuditSeverity {
  INFO
  WARNING
  CRITICAL
}

// ==========================================
// TRANSFER SCHEMA - ADDITIONAL
// ==========================================

// prisma/schemas/transfer.prisma
// ===== TRANSFER SYSTEM - Department to Department =====
// ‚úÖ UPDATED: Match UI Types 100%

// ===== TRANSFER REQUEST (Organization Level) =====
model Transfer {
  id             String   @id @default(cuid())
  organizationId String
  
  // Transfer Reference
  code           String   // ‚úÖ CHANGED: transferCode ‚Üí code (match UI)
  title          String   // "‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô OPD"
  
  // Department Context
  requestingDepartmentId String  // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å (destination)
  supplyingDepartmentId  String  // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (source)
  
  // Request Info
  requestReason  String?  // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å
  notes          String?  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  priority       TransferPriority @default(NORMAL)
  
  // ‚úÖ CHANGED: Transfer-Level Status (‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á UI ‡πÅ‡∏•‡∏∞ computed)
  status         TransferStatus @default(PENDING)  // UI status (includes APPROVED/PREPARED/DELIVERED)
  
  // Timeline
  requestedAt    DateTime  @default(now())
  approvedAt     DateTime?
  preparedAt     DateTime?  // ‚úÖ ADDED: For UI timeline
  deliveredAt    DateTime?  // ‚úÖ ADDED: For UI timeline
  cancelledAt    DateTime?
  
  // Cancellation
  cancelReason   String?
  
  // User Tracking
  requestedBy         String
  requestedBySnapshot Json?
  
  // ‚úÖ REMOVED: approvedBy, cancelledBy (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô transfer level)
  
  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  organization        Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  requestingDepartment Department  @relation("TransferRequesting", fields: [requestingDepartmentId], references: [id], onDelete: Restrict)
  supplyingDepartment  Department  @relation("TransferSupplying", fields: [supplyingDepartmentId], references: [id], onDelete: Restrict)
  
  items          TransferItem[]
  statusHistory  TransferHistory[]
  
  // Indexes
  @@unique([organizationId, code])
  @@index([organizationId, status])
  @@index([requestingDepartmentId, status])
  @@index([supplyingDepartmentId, status])
  @@index([requestedAt])
  @@index([status, priority])
  @@map("transfers")
}

// ===== TRANSFER ITEMS (Item-Level Status) =====
model TransferItem {
  id             String   @id @default(cuid())
  transferId     String
  
  // ‚úÖ CHANGED: Product Info (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö snapshot ‡∏ã‡πâ‡∏≥ - join ‡∏Å‡∏±‡∏ö Product table)
  productId      String
  
  // Item-Level Status
  status         TransferItemStatus @default(PENDING)
  
  // Quantity Tracking
  requestedQuantity Int
  approvedQuantity  Int?
  preparedQuantity  Int?
  receivedQuantity  Int?
  
  // Notes
  notes          String?
  cancelReason   String?  // ‚úÖ CHANGED: rejectReason ‚Üí cancelReason (match UI)
  
  // Timeline
  approvedAt     DateTime?
  preparedAt     DateTime?
  deliveredAt    DateTime?
  cancelledAt    DateTime?
  
  // ‚úÖ REMOVED: User Tracking (‡πÉ‡∏ä‡πâ History ‡πÅ‡∏ó‡∏ô - avoid duplication)
  
  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  transfer       Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
  product        Product  @relation(fields: [productId], references: [id], onDelete: Restrict)
  batches        TransferBatch[]  // ‚úÖ ADDED: Separate table instead of JSON
  
  // Indexes
  @@index([transferId])
  @@index([productId])
  @@index([status])
  @@index([transferId, status])
  @@map("transfer_items")
}

// ===== TRANSFER BATCH (Batch Selection) =====
// ‚úÖ ADDED: Separate table for batches (better than JSON)
model TransferBatch {
  id              String   @id @default(cuid())
  transferItemId  String
  batchId         String
  quantity        Int      // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°
  receivedQuantity Int?    // ‚úÖ NEW: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á
  
  // Timestamps
  createdAt       DateTime @default(now())
  
  // Relations
  transferItem    TransferItem @relation(fields: [transferItemId], references: [id], onDelete: Cascade)
  batch           StockBatch   @relation(fields: [batchId], references: [id], onDelete: Restrict)
  
  // Indexes
  @@index([transferItemId])
  @@index([batchId])
  @@map("transfer_batches")
}

// ===== TRANSFER HISTORY (Audit Trail) =====
// ‚úÖ CHANGED: Rename to match UI types
model TransferHistory {
  id             String   @id @default(cuid())
  transferId     String
  itemId         String?  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö item-level actions
  
  // ‚úÖ CHANGED: Action info (match UI types)
  action         String   // "APPROVED", "PREPARED", "DELIVERED", "CANCELLED"
  fromStatus     String?
  toStatus       String?
  
  // Who & Why
  changedBy         String
  changedBySnapshot Json?
  notes          String?
  
  // Timestamp
  createdAt      DateTime @default(now())
  
  // Relations
  transfer       Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
  
  // Indexes
  @@index([transferId, createdAt(sort: Desc)])
  @@index([itemId])
  @@map("transfer_histories")
}

// ===== ENUMS =====
// ‚úÖ CHANGED: Match UI types exactly
enum TransferStatus {
  PENDING      // ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  APPROVED     // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (all items approved)
  PREPARED     // ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß (all items prepared)
  DELIVERED    // ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß (all items delivered)
  PARTIAL      // ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  COMPLETED    // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (alias for DELIVERED)
  CANCELLED    // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
}

enum TransferItemStatus {
  PENDING      // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  APPROVED     // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  PREPARED     // ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß
  DELIVERED    // ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß
  CANCELLED    // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
}

enum TransferPriority {
  NORMAL       // ‡∏õ‡∏Å‡∏ï‡∏¥
  URGENT       // ‡∏î‡πà‡∏ß‡∏ô
  CRITICAL     // ‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å
}
